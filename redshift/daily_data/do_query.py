#!/usr/bin/python
import psycopg2
import os
import datetime
import time
from dateutil.relativedelta import relativedelta
import sys

k_secret_key = os.getenv('AWS_SECRET_KEY')
k_access_key_id = os.getenv('AWS_ACCESS_KEY_ID')
k_redshift_password = os.getenv('REDSHIFT_PASSWORD')
account_ids = [1,1002,1003,1006,1012,1013,1021,1038,1049,1050,1057,1060,1061,1062,1063,1066,1067,1068,1071,1072,1075,1086,1087,1092,1093,1096,1106,1107,1112,1113,1129,1130,1132,1133,1134,1135,1136,1137,1138,1139,1140,1141,1143,1145,1147,1149,1154,1155,1156,1158,1159,1161,1164,1168,1170,1172,1173,1180,1182,1183,1184,1188,1190,1192,1193,1194,1197,1202,1203,1204,1206,1207,1208,1210,1215,1216,1217,1219,1221,1222,1225,1228,1229,1230,1232,1253,1257,1278,1281,1288,1292,1294,1300,1305,1307,1308,1309,1310,1314,1319,1321,1322,1323,1324,1330,1334,1338,1345,1347,1350,1351,1354,1356,1357,1358,1361,1363,1372,1373,1376,1378,1384,1387,1388,1393,1398,1399,1400,1403,1404,1405,1409,1414,1415,1420,1421,1422,1424,1425,1426,1427,1428,1429,1430,1432,1435,1436,1437,1438,1439,1442,1443,1445,1446,1447,1449,1450,1452,1454,1455,1456,1459,1463,1465,1469,1472,1473,1476,1477,1479,1480,1484,1486,1487,1488,1489,1490,1495,1496,1497,1498,1501,1502,1503,1504,1505,1507,1508,1512,1514,1515,1516,1517,1518,1519,1520,1522,1524,1526,1528,1534,1536,1537,1538,1539,1541,1542,1544,1545,1546,1548,1550,1554,1555,1557,1561,1562,1563,1566,1568,1571,1572,1574,1578,1579,1580,1581,1585,1586,1589,1590,1593,1595,1596,1600,1601,1603,1605,1606,1607,1609,1610,1611,1614,1615,1617,1619,1620,1621,1622,1623,1630,1632,1639,1642,1643,1646,1650,1660,1664,1669,1673,1675,1676,1679,1680,1690,1691,1693,1695,1698,1702,1705,1708,1710,1711,1714,1721,1722,1723,1724,1725,1727,1731,1745,1746,1748,1749,1750,1751,1754,1755,1759,1760,1761,1764,1765,1766,1768,1770,1771,1775,1776,1779,1780,1790,1791,1792,1796,1806,1809,1812,1816,1817,1820,1823,1824,1828,1829,1834,1839,1840,1843,1844,1848,1849,1853,1855,1856,1859,1860,1861,1862,1863,1864,1865,1866,1867,1868,1880,1882,1886,1887,1888,1889,1892,1893,1896,1897,1898,1899,1903,1905,1908,1911,1912,1918,1926,1930,1931,1943,1945,1950,1959,1963,1969,15001,15007,15010,15014,15018,15023,15024,15026,15029,15030,15033,15039,15042,15043,15050,15052,15053,15057,15060,15061,15062,15064,15067,15068,15069,15070,15071,15073,15074,15075,15076,15077,15081,15082,15083,15084,15085,15086,15090,15094,15098,15100,15104,15105,15106,15109,15110,15115,15116,15117,15119,15120,15121,15125,15126,15129,15130,15132,15133,15134,15138,15139,15143,15147,15148,15149,15151,15153,15154,15155,15157,15159,15160,15163,15164,15167,15169,15170,15172,15173,15174,15175,15179,15180,15187,15190,15192,15194,15197,15201,15202,15203,15207,15210,15214,15216,15217,15218,15223,15224,15226,15227,15234,15235,15236,15237,15240,15241,15242,15244,15248,15249,15251,15253,15254,15256,15257,15259,15260,15266,15268,15271,15274,15275,15278,15279,15280,15281,15284,15286,15287,15288,15291,15292,15294,15295,15297,15298,15299,15300,15302,15304,15305,15306,15308,15309,15310,15311,15313,15314,15315,15316,15317,15318,15320,15321,15323,15324,15328,15333,15336,15337,15338,15340,15342,15343,15348,15354,15355,15356,15357,15360,15361,15362,15365,15366,15369,15370,15373,15374,15375,15377,15383,15385,15386,15389,15392,15398,15399,15401,15404,15411,15416,15417,15418,15420,15421,15427,15429,15431,15439,15443,15444,15446,15451,15452,15455,15456,15457,15459,15463,15466,15468,15472,15473,15479,15483,15485,15487,15488,15490,15494,15495,15499,15504,15507,15509,15510,15514,15516,15521,15522,15525,15529,15532,15533,15536,15537,15540,15541,15542,15543,15544,15545,15546,15547,15549,15554,15555,15556,15557,15562,15564,15566,15569,15571,15572,15573,15574,15575,15576,15582,15584,15586,15587,15593,15594,15596,15602,15604,15605,15607,15608,15611,15614,15615,15623,15626,15630,15633,15634,15635,15637,15643,15648,15651,15652,15655,15658,15659,15661,15663,15665,15666,15668,15669,15670,15671,15676,15683,15686,15687,15689,15698,15702,15703,15711,15720,15721,15722,15724,15736,15737,15739,15740,15742,15743,15747,15748,15750,15753,15772,15780,15781,15783,15784,15789,15790,15791,15792,15795,15797,15799,15800,15802,15806,15807,15814,15815,15816,15818,15820,15821,15822,15823,15827,15828,15829,15831,15833,15834,15837,15838,15839,15840,15841,15843,15844,15845,15849,15851,15852,15853,15854,15855,15856,15857,15858,15862,15863,15866,15867,15868,15869,15870,15871,15872,15873,15874,15875,15876,15877,15878,15880,15884,15888,15891,15892,15893,15897,15899,15900,15902,15904,15907,15908,15909,15910,15911,15913,15916,15919,15920,15921,15923,15924,15925,15926,15928,15930,15932,15933,15943,15947,15949,15952,15958,15959,15960,15963,15964,15965,15966,15967,15968,15969,15970,15972,15974,15975,15979,15980,15983,15985,15987,15990,15991,15994,15995,15997,15999,16000,16002,16003,16005,16007,16013,16014,16016,16017,16020,16022,16023,16024,16027,16034,16035,16036,16042,16045,16046,16049,16050,16055,16061,16062,16063,16064,16065,16066,16068,16069,16074,16075,16078,16079,16081,16084,16086,16087,16089,16093,16095,16096,16103,16105,16106,16109,16110,16111,16113,16115,16118,16122,16123,16124,16125,16127,16128,16129,16130,16131,16132,16135,16137,16139,16140,16141,16142,16143,16146,16152,16154,16155,16156,16157,16159,16160,16161,16162,16163,16164,16165,16167,16168,16171,16173,16175,16176,16178,16179,16180,16182,16183,16185,16186,16189,16192,16193,16199,16200,16202,16204,16206,16207,16208,16209,16213,16214,16215,16216,16217,16221,16222,16223,16227,16228,16229,16231,16233,16235,16238,16239,16241,16243,16244,16248,16249,16250,16254,16255,16256,16257,16259,16260,16262,16263,16265,16268,16271,16274,16275,16276,16278,16282,16287,16289,16290,16291,16294,16298,16300,16303,16304,16307,16308,16311,16312,16319,16320,16321,16322,16324,16325,16326,16327,16328,16329,16330,16333,16334,16336,16340,16341,16343,16345,16346,16351,16354,16359,16360,16361,16364,16365,16366,16371,16374,16378,16380,16384,16385,16390,16395,16397,16399,16400,16402,16403,16404,16406,16407,16410,16419,16420,16421,16424,16425,16435,16437,16438,16440,16441,16443,16445,16446,16448,16450,16461,16465,16472,16473,16474,16478,16481,16483,16490,16496,16502,16503,16508,16510,16514,16515,16517,16519,16520,16525,16530,16532,16533,16535,16536,16540,16543,16546,16547,16548,16550,16551,16554,16555,16558,16560,16561,16562,16567,16574,16577,16579,16582,16583,16586,16588,16590,16591,16592,16600,16602,16607,16609,16610,16612,16615,16616,16618,16622,16624,16627,16631,16635,16643,16644,16646,16650,16653,16660,16661,16664,16666,16667,16670,16672,16673,16674,16675,16677,16682,16684,16687,16690,16691,16693,16696,16697,16698,16699,16700,16702,16712,16713,16717,16718,16719,16724,16725,16727,16729,16734,16735,16736,16737,16738,16739,16740,16741,16742,16744,16745,16746,16750,16752,16753,16755,16757,16758,16759,16760,16762,16766,16767,16771,16776,16777,16778,16779,16780,16785,16786,16787,16788,16789,16790,16793,16794,16796,16797,16799,16801,16802,16803,16805,16806,16807,16810,16812,16813,16814,16816,16818,16820,16822,16823,16824,16825,16826,16833,16834,16835,16836,16837,16838,16839,16840,16841,16842,16843,16844,16847,16848,16849,16851,16852,16854,16855,16856,16858,16859,16860,16861,16862,16863,16864,16867,16870,16874,16877,16878,16880,16881,16883,16884,16886,16887,16889,16890,16891,16892,16893,16894,16895,16896,16899,16900,16901,16903,16905,16906,16908,16909,16911,16912,16913,16914,16915,16916,16920,16921,16923,16924,16925,16926,16927,16929,16930,16931,16934,16935,16939,16940,16941,16942,16943,16945,16946,16950,16951,16953,16954,16956,16957,16959,16961,16964,16967,16968,16970,16971,16972,16974,16977,16978,16979,16980,16984,16987,16988,16989,16990,16991,16992,16993,16994,16995,16996,16997,16999,17000,17001,17003,17005,17007,17010,17011,17014,17016,17018,17020,17021,17024,17026,17029,17030,17031,17032,17034,17035,17036,17037,17038,17040,17041,17042,17044,17045,17047,17048,17049,17050,17052,17053,17054,17056,17058,17059,17061,17063,17065,17066,17067,17068,17069,17071,17072,17074,17075,17076,17078,17079,17082,17083,17084,17086,17089,17092,17095,17096,17097,17098,17099,17102,17104,17105,17106,17107,17110,17113,17114,17117,17118,17119,17121,17124,17127,17133,17137,17139,17140,17144,17145,17146,17150,17152,17156,17157,17161,17163,17164,17166,17167,17168,17170,17171,17172,17174,17175,17176,17177,17178,17180,17182,17183,17185,17187,17189,17191,17192,17194,17195,17196,17197,17201,17202,17204,17205,17207,17211,17216,17219,17220,17221,17222,17223,17224,17227,17232,17234,17235,17236,17239,17241,17243,17245,17250,17253,17255,17256,17258,17264,17266,17269,17270,17271,17274,17275,17276,17279,17281,17282,17286,17287,17291,17292,17294,17295,17296,17302,17304,17305,17307,17308,17311,17313,17314,17315,17316,17323,17328,17330,17331,17332,17334,17335,17337,17339,17344,17348,17349,17351,17352,17354,17356,17357,17358,17360,17362,17367,17370,17374,17375,17377,17379,17382,17383,17385,17388,17390,17392,17393,17394,17395,17396,17397,17399,17401,17403,17404,17406,17407,17410,17411,17413,17414,17416,17417,17419,17423,17424,17427,17428,17429,17431,17432,17434,17435,17437,17440,17441,17442,17443,17444,17446,17447,17450,17451,17453,17456,17459,17460,17461,17463,17464,17465,17467,17468,17470,17472,17477,17481,17486,17487,17488,17490,17491,17495,17498,17499,17501,17503,17505,17506,17508,17512,17514,17518,17522,17525,17526,17530,17531,17534,17536,17537,17539,17540,17543,17544,17545,17546,17547,17548,17551,17553,17556,17557,17560,17566,17569,17572,17573,17575,17576,17582,17584,17585,17586,17587,17588,17590,17591,17592,17593,17594,17595,17596,17597,17601,17602,17604,17605,17606,17608,17610,17612,17615,17616,17618,17619,17621,17623,17627,17631,17636,17639,17641,17642,17644,17645,17646,17647,17648,17651,17653,17654,17657,17658,17659,17660,17664,17666,17667,17669,17670,17673,17674,17677,17681,17683,17684,17686,17687,17688,17689,17690,17694,17697,17699,17700,17703,17707,17709,17710,17712,17714,17716,17718,17720,17721,17722,17723,17724,17727,17729,17730,17731,17732,17734,17736,17742,17745,17746,17747,17748,17749,17751,17752,17753,17755,17756,17758,17761,17765,17768,17769,17773,17774,17785,17787,17788,17789,17790,17792,17794,17796,17804,17805,17809,17810,17811,17812,17814,17815,17816,17817,17818,17819,17822,17825,17827,17832,17834,17835,17837,17839,17840,17842,17843,17844,17847,17848,17849,17851,17853,17854,17856,17861,17863,17865,17866,17867,17870,17872,17875,17878,17879,17883,17886,17888,17889,17893,17895,17899,17900,17901,17902,17903,17904,17905,17907,17908,17911,17912,17913,17914,17920,17921,17922,17926,17931,17933,17937,17938,17939,17940,17942,17943,17944,17945,17947,17948,17949,17950,17951,17953,17958,17959,17961,17964,17965,17967,17969,17972,17973,17975,17979,17980,17984,17985,17986,17987,17989,17990,17992,17993,17994,18002,18003,18004,18005,18006,18007,18013,18014,18015,18019,18020,18021,18022,18023,18024,18025,18032,18033,18036,18037,18038,18039,18041,18043,18045,18049,18050,18051,18052,18055,18056,18057,18060,18062,18064,18065,18067,18068,18074,18079,18082,18084,18086,18088,18090,18091,18092,18098,18102,18104,18105,18106,18108,18110,18114,18116,18119,18120,18121,18123,18124,18126,18128,18136,18137,18138,18140,18141,18142,18145,18146,18147,18148,18151,18152,18153,18154,18155,18159,18160,18161,18163,18164,18166,18169,18171,18175,18176,18177,18178,18180,18183,18184,18186,18189,18191,18194,18196,18199,18200,18201,18205,18206,18207,18208,18209,18210,18211,18212,18216,18217,18220,18221,18222,18224,18229,18231,18232,18237,18238,18240,18242,18246,18251,18252,18253,18257,18259,18260,18264,18269,18270,18272,18274,18276,18277,18278,18279,18285,18286,18288,18290,18291,18294,18298,18299,18301,18302,18303,18306,18308,18312,18314,18317,18318,18319,18320,18321,18323,18325,18328,18329,18332,18335,18336,18340,18342,18345,18351,18354,18359,18362,18364,18365,18366,18369,18370,18373,18374,18376,18378,18379,18381,18383,18387,18389,18392,18395,18396,18397,18398,18399,18400,18402,18404,18405,18406,18407,18409,18411,18412,18415,18416,18417,18418,18419,18422,18423,18424,18425,18428,18430,18434,18435,18437,18439,18443,18448,18451,18452,18453,18456,18457,18459,18461,18463,18464,18465,18466,18468,18469,18470,18471,18472,18474,18475,18479,18481,18483,18487,18491,18493,18494,18497,18498,18500,18505,18520,18523,18524,18527,18528,18531,18533,18535,18537,18539,18540,18542,18543,18544,18547,18550,18551,18552,18553,18554,18558,18559,18561,18562,18563,18564,18566,18567,18572,18574,18575,18576,18577,18578,18579,18580,18582,18583,18584,18588,18589,18594,18603,18605,18606,18607,18610,18620,18621,18622,18623,18628,18629,18631,18632,18633,18635,18636,18637,18638,18640,18641,18644,18648,18649,18651,18652,18653,18656,18657,18658,18660,18666,18669,18671,18672,18674,18675,18681,18684,18686,18687,18690,18694,18696,18702,18703,18705,18706,18716,18719,18721,18726,18727,18729,18731,18732,18733,18734,18739,18740,18741,18747,18748,18749,18751,18754,18756,18764,18766,18767,18768,18771,18783,18784,18787,18788,18789,18791,18793,18794,18799,18801,18803,18804,18805,18808,18810,18812,18814,18815,18817,18818,18821,18824,18825,18826,18827,18830,18831,18832,18833,18835,18836,18837,18838,18840,18842,18844,18845,18846,18847,18848,18850,18851,18853,18854,18856,18857,18858,18859,18860,18861,18862,18863,18865,18866,18868,18871,18872,18874,18876,18877,18878,18879,18880,18881,18883,18884,18886,18887,18888,18892,18893,18895,18896,18897,18899,18900,18902,18903,18904,18908,18909,18910,18913,18916,18918,18920,18921,18925,18926,18927,18928,18929,18930,18933,18935,18936,18938,18939,18940,18941,18943,18944,18946,18947,18948,18950,18951,18952,18953,18954,18956,18957,18958,18962,18965,18967,18968,18969,18970,18974,18976,18977,18978,18979,18980,18981,18983,18984,18985,18986,18989,18990,18991,18992,18994,18996,18999,19000,19003,19006,19008,19014,19016,19020,19021,19024,19025,19026,19028,19029,19030,19031,19032,19033,19034,19035,19036,19047,19049,19050,19051,19052,19053,19054,19057,19059,19060,19063,19064,19067,19068,19072,19074,19075,19076,19079,19080,19081,19082,19083,19086,19087,19088,19089,19090,19091,19092,19094,19095,19097,19098,19099,19100,19101,19103,19104,19106,19110,19111,19113,19115,19116,19117,19123,19124,19126,19127,19128,19130,19131,19132,19133,19134,19135,19138,19139,19140,19143,19145,19147,19148,19149,19150,19152,19154,19157,19158,19162,19163,19165,19166,19168,19170,19171,19172,19173,19174,19176,19182,19183,19184,19187,19188,19189,19190,19193,19194,19195,19197,19198,19201,19205,19206,19207,19208,19210,19212,19213,19214,19215,19216,19217,19219,19220,19221,19222,19223,19226,19229,19230,19233,19234,19240,19241,19242,19243,19245,19247,19248,19249,19250,19251,19252,19253,19255,19256,19259,19262,19263,19264,19265,19267,19268,19269,19270,19273,19278,19282,19283,19287,19289,19290,19292,19296,19300,19302,19304,19308,19312,19313,19316,19322,19327,19328,19329,19333,19334,19340,19341,19343,19344,19351,19354,19356,19357,19359,19363,19366,19367,19368,19370,19373,19375,19376,19379,19380,19381,19383,19384,19386,19387,19390,19391,19392,19395,19398,19399,19400,19402,19403,19405,19406,19407,19408,19412,19421,19422,19424,19426,19427,19429,19434,19435,19439,19440,19441,19442,19443,19444,19445,19446,19447,19454,19455,19460,19461,19463,19464,19468,19469,19473,19474,19475,19476,19479,19480,19482,19483,19484,19489,19490,19492,19494,19496,19498,19503,19504,19505,19506,19510,19511,19512,19514,19517,19518,19520,19521,19523,19524,19525,19527,19531,19535,19536,19538,19539,19540,19543,19544,19546,19548,19550,19551,19554,19555,19557,19561,19563,19564,19565,19566,19568,19570,19571,19572,19573,19574,19575,19576,19578,19580,19581,19583,19584,19586,19590,19591,19592,19593,19594,19595,19597,19598,19599,19600,19602,19604,19608,19611,19613,19615,19617,19618,19621,19623,19625,19628,19629,19634,19635,19637,19639,19641,19643,19644,19645,19647,19648,19649,19656,19657,19661,19665,19666,19667,19668,19669,19670,19674,19675,19683,19684,19685,19688,19689,19693,19697,19699,19700,19701,19706,19707,19710,19711,19712,19715,19716,19717,19718,19719,19720,19722,19723,19724,19725,19727,19729,19730,19731,19732,19733,19734,19740,19741,19744,19745,19746,19747,19748,19750,19753,19754,19762,19763,19767,19770,19772,19774,19775,19776,19777,19781,19784,19785,19786,19789,19795,19796,19797,19798,19800,19802,19804,19805,19807,19809,19811,19812,19815,19816,19817,19818,19822,19823,19824,19826,19827,19829,19830,19835,19836,19837,19838,19839,19840,19841,19842,19844,19845,19846,19851,19852,19853,19860,19863,19865,19868,19869,19870,19871,19872,19875,19877,19885,19889,19891,19893,19895,19898,19899,19901,19902,19905,19908,19912,19914,19915,19919,19920,19925,19926,19931,19939,19940,19941,19942,19943,19944,19945,19949,19952,19953,19955,19957,19958,19962,19966,19967,19968,19972,19973,19974,19976,19981,19982,19984,19985,19989,19990,19991,19992,19993,19994,19996,19997,19998,19999,20000,20001,20002,20005,20008,20009,20013,20017,20022,20023,20024,20028,20029,20030,20031,20036,20037,20040,20043,20045,20046,20047,20048,20049,20050,20051,20052,20053,20054,20055,20056,20057,20059,20061,20062,20064,20067,20068,20069,20077,20079,20080,20081,20084,20086,20087,20089,20090,20091,20092,20093,20094,20096,20100,20101,20102,20103,20104,20106,20108,20110,20117,20118,20122,20123,20125,20126,20127,20128,20129,20130,20133,20134,20135,20140,20145,20148,20151,20152,20156,20157,20158,20163,20165,20166,20167,20168,20170,20171,20174,20178,20179,20180,20189,20190,20191,20192,20193,20194,20195,20196,20199,20200,20205,20207,20208,20209,20214,20216,20218,20219,20221,20222,20224,20225,20226,20233,20234,20236,20238,20239,20245,20249,20251,20261,20263,20268,20270,20271,20273,20274,20277,20283,20285,20286,20291,20292,20293,20301,20302,20303,20305,20306,20309,20311,20313,20314,20316,20318,20319,20324,20325,20326,20327,20329,20332,20333,20335,20336,20342,20345,20351,20354,20357,20358,20370,20371,20376,20377,20378,20379,20380,20382,20384,20386,20388,20389,20390,20392,20393,20396,20399,20401,20402,20403,20404,20406,20407,20411,20415,20416,20419,20421,20423,20425,20427,20428,20433,20435,20438,20439,20440,20441,20442,20443,20446,20447,20449,20453,20455,20456,20459,20468,20471,20473,20474,20477,20483,20484,20485,20486,20489,20491,20493,20496,20497,20501,20509,20510,20511,20515,20516,20518,20519,20520,20521,20525,20526,20527,20534,20535,20536,20538,20540,20541,20543,20544,20546,20551,20554,20558,20560,20562,20563,20565,20566,20567,20569,20574,20575,20577,20578,20579,20581,20582,20583,20584,20586,20587,20589,20590,20592,20593,20596,20598,20599,20601,20604,20605,20606,20607,20608,20609,20613,20616,20618,20619,20621,20623,20624,20625,20626,20627,20629,20631,20632,20633,20635,20636,20637,20638,20639,20640,20642,20643,20647,20649,20651,20652,20654,20655,20656,20657,20659,20660,20661,20662,20664,20665,20666,20667,20669,20670,20672,20675,20676,20677,20679,20680,20681,20682,20683,20684,20685,20687,20688,20691,20692,20693,20699,20700,20701,20703,20704,20712,20713,20717,20718,20719,20720,20721,20723,20725,20726,20727,20728,20730,20732,20735,20737,20741,20743,20744,20746,20748,20749,20750,20751,20752,20753,20754,20755,20756,20757,20760,20761,20767,20769,20770,20771,20772,20774,20775,20779,20780,20781,20784,20785,20786,20787,20788,20790,20791,20792,20795,20796,20797,20798,20799,20800,20802,20803,20804,20805,20807,20808,20809,20813,20815,20816,20819,20820,20821,20822,20825,20826,20827,20828,20830,20832,20833,20835,20838,20839,20840,20843,20844,20846,20848,20850,20851,20852,20853,20854,20855,20856,20859,20860,20862,20863,20865,20866,20867,20868,20869,20874,20875,20877,20878,20879,20880,20881,20882,20883,20884,20885,20886,20887,20888,20890,20891,20892,20893,20894,20899,20900,20901,20902,20903,20905,20907,20908,20909,20911,20913,20914,20915,20916,20918,20919,20920,20921,20922,20923,20925,20926,20928,20930,20931,20933,20937,20939,20940,20941,20942,20943,20944,20945,20946,20948,20950,20952,20953,20954,20955,20956,20957,20958,20961,20962,20963,20964,20965,20967,20968,20971,20973,20974,20975,20976,20980,20981,20982,20984,20986,20987,20988,20989,20990,20994,20995,20996,20997,20998,21001,21002,21005,21006,21009,21011,21012,21013,21014,21015,21016,21017,21018,21019,21021,21022,21023,21024,21025,21027,21028,21029,21031,21032,21033,21034,21035,21036,21040,21041,21042,21044,21045,21046,21047,21048,21049,21054,21056,21058,21059,21060,21061,21062,21063,21064,21065,21067,21068,21069,21071,21073,21074,21075,21077,21078,21079,21081,21087,21088,21090,21091,21094,21098,21099,21100,21102,21103,21104,21106,21110,21111,21113,21114,21115,21116,21118,21122,21123,21125,21126,21128,21129,21130,21131,21132,21133,21136,21137,21138,21140,21141,21142,21144,21145,21150,21155,21158,21161,21164,21165,21167,21168,21169,21170,21171,21172,21173,21175,21176,21180,21181,21182,21183,21187,21189,21190,21191,21193,21194,21196,21197,21198,21201,21202,21203,21205,21206,21208,21210,21213,21215,21216,21217,21218,21221,21222,21225,21226,21228,21231,21232,21234,21235,21237,21238,21239,21242,21243,21244,21245,21246,21247,21251,21252,21253,21255,21256,21257,21260,21261,21262,21263,21265,21266,21267,21270,21272,21273,21274,21275,21276,21279,21281,21285,21286,21288,21289,21290,21292,21293,21294,21295,21297,21299,21300,21301,21302,21305,21311,21312,21314,21315,21316,21318,21319,21320,21321,21322,21323,21324,21325,21326,21327,21328,21329,21331,21332,21334,21335,21337,21338,21339,21340,21343,21344,21347,21348,21350,21351,21353,21354,21355,21359,21361,21363,21364,21366,21367,21373,21374,21375,21377,21379,21380,21382,21383,21384,21385,21387,21392,21401,21404,21405,21406,21407,21408,21409,21410,21414,21416,21417,21419,21420,21422,21423,21425,21427,21429,21432,21435,21436,21438,21440,21442,21444,21445,21446,21449,21451,21452,21453,21456,21457,21460,21461,21466,21467,21468,21469,21473,21476,21478,21480,21483,21485,21486,21487,21492,21493,21494,21496,21499,21501,21502,21503,21505,21506,21507,21508,21511,21512,21514,21516,21517,21520,21521,21523,21524,21526,21528,21529,21530,21531,21533,21534,21536,21537,21540,21541,21543,21546,21547,21548,21549,21550,21551,21554,21555,21557,21560,21561,21562,21564,21565,21566,21567,21568,21574,21575,21579,21581,21583,21584,21585,21588,21590,21591,21592,21593,21594,21596,21599,21600,21601,21603,21605,21606,21607,21608,21609,21610,21612,21613,21614,21615,21616,21617,21619,21620,21622,21623,21625,21626,21627,21628,21632,21633,21634,21636,21637,21638,21642,21644,21645,21646,21647,21649,21650,21651,21652,21654,21660,21663,21666,21667,21668,21671,21673,21675,21677,21678,21679,21683,21684,21687,21688,21689,21693,21694,21696,21697,21698,21700,21701,21702,21704,21706,21709,21713,21714,21716,21718,21719,21720,21722,21723,21724,21725,21726,21727,21729,21730,21731,21732,21735,21736,21737,21745,21746,21747,21749,21752,21753,21755,21756,21757,21759,21760,21761,21762,21764,21766,21767,21768,21770,21771,21775,21776,21778,21779,21780,21781,21782,21783,21786,21787,21788,21789,21790,21792,21793,21798,21799,21800,21801,21802,21803,21804,21806,21807,21809,21812,21813,21815,21816,21819,21821,21823,21825,21827,21828,21829,21831,21833,21835,21839,21841,21843,21844,21845,21847,21848,21849,21850,21854,21855,21856,21858,21861,21862,21866,21867,21868,21869,21870,21871,21873,21874,21875,21876,21877,21878,21880,21881,21882,21883,21884,21885,21886,21887,21888,21889,21890,21892,21893,21894,21896,21899,21902,21904,21906,21907,21908,21910,21911,21912,21913,21914,21915,21916,21917,21918,21919,21921,21922,21926,21927,21929,21930,21931,21933,21936,21938,21939,21940,21942,21944,21946,21948,21950,21953,21954,21955,21956,21957,21961,21962,21965,21968,21969,21975,21978,21979,21981,21983,21984,21985,21986,21988,21989,21992,21993,21994,21995,21996,22001,22002,22004,22005,22006,22007,22009,22010,22011,22012,22013,22015,22018,22020,22022,22023,22024,22025,22026,22028,22031,22032,22033,22034,22035,22036,22038,22039,22043,22044,22048,22051,22052,22053,22054,22055,22056,22057,22059,22060,22064,22065,22066,22067,22068,22069,22071,22072,22075,22077,22078,22079,22081,22082,22083,22085,22086,22087,22091,22093,22094,22096,22098,22100,22102,22104,22105,22106,22109,22110,22111,22114,22115,22116,22118,22120,22121,22122,22123,22124,22125,22126,22127,22128,22133,22134,22135,22137,22139,22140,22144,22145,22146,22147,22149,22150,22152,22154,22155,22158,22159,22160,22164,22165,22172,22173,22176,22177,22178,22183,22184,22186,22187,22188,22189,22190,22194,22196,22197,22199,22200,22202,22205,22209,22211,22217,22220,22222,22224,22226,22228,22229,22230,22231,22232,22233,22234,22235,22237,22238,22239,22240,22242,22243,22245,22246,22247,22249,22254,22255,22261,22262,22266,22267,22270,22273,22274,22278,22279,22282,22284,22286,22287,22288,22289,22290,22292,22295,22301,22302,22305,22310,22311,22313,22314,22316,22317,22318,22321,22322,22323,22325,22327,22328,22329,22330,22331,22333,22334,22335,22336,22337,22338,22339,22340,22342,22344,22345,22346,22347,22349,22351,22353]
accounts_str = [str(s) for s in account_ids]
accounts = ','.join(accounts_str)

start_day = '2015-12-01'

num_days = 300

def get_conn():
    conn = psycopg2.connect("dbname='sensors1' user='benjo' host='sensors2.cy7n0vzxfedi.us-east-1.redshift.amazonaws.com' port=5439 password='%s'" % k_redshift_password)
    return conn

def main():
    conn = get_conn()
    with open(sys.argv[1],'r') as f: query_str = f.read()
         
    start_date = datetime.datetime.strptime(start_day,'%Y-%m-%d') 

    for i in range(num_days):
        target_date = start_date + relativedelta(days=i)
        end_date = target_date + relativedelta(days=1);

        start_str = target_date.strftime('%Y-%m-%d 12:00:00' )
        end_str = end_date.strftime('%Y-%m-%d 12:00:00')
        results_target = target_date.strftime('%Y-%m-%d')
        query = query_str.format(accounts,start_str,end_str,results_target,k_access_key_id,k_secret_key)
        try:
            print query

            cur = conn.cursor()

            tic1 = time.time()
            cur.execute(query)
            tic2 = time.time()

            print tic2 - tic1
        except Exception as detail:
            print detail
            conn.close()
            conn = get_conn()
             
        
   

if __name__=='__main__':
    main()


